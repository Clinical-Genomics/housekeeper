{% extends "layout.html" %}
{% import "components.html" as components %}

{% block main_content %}
  <form action="{{ url_for('samples') }}">
    <div class="card mb-3">
      <div class="card-block">
        <div class="row">
          <div class="col-10">
            <input class="form-control" type="text" name="query_str" value="{{ qargs.query_str if qargs.query_str }}">
          </div>
          <div class="col-2">
            <button class="btn btn-info form-control">Search</button>
          </div>
        </div>
      </div>
      <div class="card-footer">
        <select class="form-control" name="status_to">
          <option value="">Samples to...</option>
          {% for status in ['sequence', 'confirm'] %}
            <option value="{{ status }}" {% if status == qargs.status_to %}selected{% endif %}>Samples to {{ status }}</option>
          {% endfor %}
        </select>
      </div>
    </div>
  </form>

  {{ samples_table(samples.items) }}

  <div class="card mb-3">
    <div class="card-block">
      <div class="row">
        <div class="col-4">
          {% if samples.has_prev %}
            <a href="{{ url_for('samples', page=samples.prev_num, **qargs) }}">Previous</a>
          {% endif %}
        </div>
        <div class="col-4 text-center">
          Page {{ samples.page }} <small class="text-muted">({{ samples.total }} samples)</small>
        </div>
        <div class="col-4 text-right">
          {% if samples.has_next %}
            <a href="{{ url_for('samples', page=samples.next_num, **qargs) }}">Next</a>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% macro samples_table(samples) %}
  <table class="table table-bordered table-hover">
    <thead>
      <tr>
        <th>Sample</th>
        <th>Case</th>
        <th>Received at</th>
        <th>Sequenced at</th>
        <th>Flowcells</th>
        <th>Confirmed at</th>
      </tr>
    </thead>
    <tbody>
      {% for sample in samples %}
        <tr {% if sample.priority %} class="bg-info" {% endif %}>
          <td>
            {{ sample.lims_id }}
          </td>
          <td>
            <a href="{{ url_for('case', name=sample.case.name) }}">
              {{ sample.case.name }}
            </a>
          </td>
          <td>{{ sample.received_at.date() if sample.received_at }}</td>
          <td>
            {% if sample.sequenced_at %}
              {{ sample.sequenced_at.date() }}
              {% if sample.received_at %}
                <span class="badge badge-default pull-right">
                  {{ (sample.sequenced_at - sample.received_at).days }} days
                </span>
              {% endif %}
            {% endif %}
          </td>
          <td>
            {% for flowcell in sample.flowcells %}
              <span class="badge badge-default">{{ flowcell }}</span>
            {% endfor %}
          </td>
          <td>{{ sample.confirmed_at.date() if sample.confirmed_at }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% endmacro %}
